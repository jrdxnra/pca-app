<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCA App Architecture - Current State</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
            border-bottom: 4px solid #667eea;
            padding-bottom: 15px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        
        .section {
            margin-bottom: 50px;
        }
        
        .section-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 20px;
            padding: 10px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            border-radius: 8px;
        }
        
        .data-sources {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .data-source {
            border: 3px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            background: #f8f9fa;
            position: relative;
        }
        
        .data-source.google {
            border-color: #4285f4;
            background: #e8f0fe;
        }
        
        .data-source.firebase {
            border-color: #ffa726;
            background: #fff3e0;
        }
        
        .source-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .source-icon {
            font-size: 2em;
        }
        
        .source-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        
        .collections {
            margin-top: 15px;
        }
        
        .collection {
            background: white;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .collection-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .collection-items {
            font-size: 0.9em;
            color: #666;
            margin-left: 15px;
        }
        
        .collection-items li {
            margin: 5px 0;
        }
        
        .flow-diagram {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 40px 0;
        }
        
        .flow-row {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .flow-box {
            flex: 1;
            min-width: 250px;
            padding: 20px;
            border-radius: 8px;
            background: white;
            border: 2px solid #ddd;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .flow-box.create {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        
        .flow-box.read {
            border-color: #2196f3;
            background: #e3f2fd;
        }
        
        .flow-box.store {
            border-color: #ff9800;
            background: #fff3e0;
        }
        
        .arrow {
            font-size: 2em;
            color: #667eea;
            font-weight: bold;
        }
        
        .flow-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #333;
        }
        
        .flow-details {
            font-size: 0.95em;
            color: #666;
            line-height: 1.6;
        }
        
        .flow-details ul {
            margin-left: 20px;
            margin-top: 8px;
        }
        
        .flow-details li {
            margin: 5px 0;
        }
        
        .code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #d63384;
        }
        
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .warning-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
        }
        
        .info {
            background: #d1ecf1;
            border-left: 4px solid #0dcaf0;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .info-title {
            font-weight: bold;
            color: #055160;
            margin-bottom: 8px;
        }
        
        .current-issue {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .current-issue-title {
            font-weight: bold;
            color: #721c24;
            margin-bottom: 8px;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid #333;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .status-works {
            background: #d4edda;
            color: #155724;
        }
        
        .status-partial {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-broken {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä PCA App Architecture - Current State</h1>
        <p class="subtitle">Visual documentation of data sources, flows, and storage</p>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #e8f5e9; border-color: #4caf50;"></div>
                <span>Create/Write Operations</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e3f2fd; border-color: #2196f3;"></div>
                <span>Read Operations</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fff3e0; border-color: #ff9800;"></div>
                <span>Data Storage</span>
            </div>
        </div>
        
        <div class="info" style="margin-bottom: 30px; background: #e7f3ff; border-left: 4px solid #2196f3;">
            <div class="info-title" style="font-size: 1.2em; color: #0d47a1;">üí° Key Concept: Schedules vs Workouts (SEPARATE but CONNECTED)</div>
            <div style="font-size: 1.05em;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #4285f4;">
                        <strong style="color: #4285f4; font-size: 1.1em;">üìÖ SCHEDULE (Calendar Events)</strong><br>
                        <strong>Location:</strong> Google Calendar API<br>
                        <strong>Contains:</strong> Dates, times, appointments<br>
                        <strong>Example:</strong> "Workout with John at 2pm on Jan 15"<br>
                        <strong>Purpose:</strong> Scheduling/time management<br>
                        <strong>When created:</strong> When user schedules an appointment
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #ffa726;">
                        <strong style="color: #ffa726; font-size: 1.1em;">üí™ WORKOUT</strong><br>
                        <strong>Location:</strong> Firebase clientWorkouts<br>
                        <strong>Contains:</strong> Exercise details, sets, reps, weights<br>
                        <strong>Example:</strong> "3x5 Squats @ 225lbs, 3x10 Bench @ 185lbs"<br>
                        <strong>Purpose:</strong> Workout content/details<br>
                        <strong>When created:</strong> When user creates workout plan
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px; border: 2px solid #4caf50;">
                    <strong style="color: #2e7d32; font-size: 1.1em;">üîó CONNECTION:</strong><br>
                    ‚Ä¢ Calendar event has <span class="code">linkedWorkoutId</span> in metadata ‚Üí points to workout<br>
                    ‚Ä¢ Workout has <span class="code">linkedWorkoutId</span> ‚Üí points back to event<br>
                    ‚Ä¢ <strong>They are SEPARATE entities</strong> (one is scheduling, one is content)<br>
                    ‚Ä¢ <strong>But they are CONNECTED</strong> via the link<br>
                    ‚Ä¢ <strong>You can have:</strong> Schedule without workout (just time slot), Workout without schedule (just exercises, no time), OR Both (scheduled workout)
                </div>
            </div>
        </div>
        
        <div class="current-issue">
            <div class="current-issue-title">‚ö†Ô∏è CURRENT ISSUE</div>
            <div>Google Calendar events are not showing up because the app is trying to read from Firebase first, but calendar events should ONLY come from Google Calendar API. Quick workouts create events in Firebase, but they should also be in Google Calendar.</div>
        </div>
        
        <div class="section">
            <div class="section-title">üóÑÔ∏è Data Sources</div>
            <div class="data-sources">
                <div class="data-source google">
                    <div class="source-header">
                        <div class="source-icon">üìÖ</div>
                        <div class="source-title">Google Calendar API</div>
                    </div>
                    <div class="collections">
                        <div class="collection">
                            <div class="collection-title">Calendar Events (Primary Source)</div>
                            <div class="collection-items">
                                <ul>
                                    <li>Period-based recurring events</li>
                                    <li>All scheduled sessions</li>
                                    <li>Event metadata (clientId, category, workoutId in extendedProperties)</li>
                                    <li><strong>Status:</strong> <span class="status-badge status-partial">Partial - Only period assignments create here</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="data-source firebase">
                    <div class="source-header">
                        <div class="source-icon">üî•</div>
                        <div class="source-title">Firebase Firestore</div>
                    </div>
                    <div class="collections">
                        <div class="collection">
                            <div class="collection-title">calendarEvents</div>
                            <div class="collection-items">
                                <ul>
                                    <li>Quick workouts (created via <span class="code">createTestEvent</span>)</li>
                                    <li>Test events</li>
                                    <li><strong>Status:</strong> <span class="status-badge status-broken">Issue - Should not exist or should sync to Google Calendar</span></li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="collection">
                            <div class="collection-title">clientWorkouts</div>
                            <div class="collection-items">
                                <ul>
                                    <li>Workout details (exercises, rounds, sets, reps, weights)</li>
                                    <li>Linked to calendar events via <span class="code">linkedWorkoutId</span></li>
                                    <li><strong>Status:</strong> <span class="status-badge status-works">‚úì Correct - This is where workouts belong</span></li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="collection">
                            <div class="collection-title">client-programs</div>
                            <div class="collection-items">
                                <ul>
                                    <li>Client training programs</li>
                                    <li>Periods and period assignments</li>
                                    <li><strong>Status:</strong> <span class="status-badge status-works">‚úì Correct</span></li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="collection">
                            <div class="collection-title">clients</div>
                            <div class="collection-items">
                                <ul>
                                    <li>Client information</li>
                                    <li><strong>Status:</strong> <span class="status-badge status-works">‚úì Correct</span></li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="collection">
                            <div class="collection-title">scheduled-workouts</div>
                            <div class="collection-items">
                                <ul>
                                    <li>Workout scheduling metadata</li>
                                    <li><strong>Status:</strong> <span class="status-badge status-works">‚úì Correct</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">üì• Reading Calendar Events (Current Flow)</div>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box read">
                        <div class="flow-title">üîµ React Query Hook</div>
                        <div class="flow-details">
                            <span class="code">useCalendarEvents(startDate, endDate)</span><br>
                            Used by: Dashboard & Schedule pages
                        </div>
                    </div>
                    <div class="arrow">‚Üí</div>
                    <div class="flow-box store">
                        <div class="flow-title">üì¶ getCalendarEventsByDateRange()</div>
                        <div class="flow-details">
                            <strong>Current Logic:</strong>
                            <ul>
                                <li>1. Check if Google Calendar connected</li>
                                <li>2. Try Google Calendar API first</li>
                                <li>3. Fall back to Firebase if fails</li>
                                <li>4. Merge both sources (deduplicate)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="flow-row">
                    <div class="flow-box read" style="border-color: #4285f4;">
                        <div class="flow-title">‚úÖ Google Calendar API</div>
                        <div class="flow-details">
                            <span class="code">/api/calendar/events?timeMin=&timeMax=</span><br>
                            <strong>Returns:</strong> Period-based recurring events<br>
                            <strong>Status:</strong> ‚úì Works (if connected)
                        </div>
                    </div>
                    <div style="width: 50px;"></div>
                    <div class="flow-box read" style="border-color: #ffa726;">
                        <div class="flow-title">‚ö†Ô∏è Firebase calendarEvents</div>
                        <div class="flow-details">
                            <span class="code">getCalendarEventsByDateRange()</span><br>
                            <strong>Returns:</strong> Quick workouts, test events<br>
                            <strong>Status:</strong> ‚ö†Ô∏è Should not be used for calendar events
                        </div>
                    </div>
                </div>
                
                <div class="current-issue">
                    <div class="current-issue-title">‚ùå PROBLEM</div>
                    <div>If Google Calendar API fails or is not connected, app falls back to Firebase. But Google Calendar should be the ONLY source for calendar events. Quick workouts created in Firebase are not visible in Google Calendar, so they're not accessible if user checks their actual calendar.</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">üì§ Creating Calendar Events (Current Flow)</div>
            
            <h3 style="margin-top: 20px; color: #333;">Path 1: Period Assignment (Recurring Events)</h3>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box create">
                        <div class="flow-title">üü¢ User Action</div>
                        <div class="flow-details">
                            Assign period to client via Schedule tab
                        </div>
                    </div>
                    <div class="arrow">‚Üí</div>
                    <div class="flow-box create">
                        <div class="flow-title">üìù useClientPrograms Hook</div>
                        <div class="flow-details">
                            <span class="code">hookAssignPeriod()</span><br>
                            Creates periods and calls calendar creation
                        </div>
                    </div>
                    <div class="arrow">‚Üí</div>
                    <div class="flow-box create">
                        <div class="flow-title">üìÖ createRecurringCalendarEvent()</div>
                        <div class="flow-details">
                            <span class="code">POST /api/calendar/events</span><br>
                            Creates recurring event in Google Calendar
                        </div>
                    </div>
                    <div class="arrow">‚Üí</div>
                    <div class="flow-box store" style="border-color: #4285f4;">
                        <div class="flow-title">‚úÖ Google Calendar</div>
                        <div class="flow-details">
                            Event stored in Google Calendar API<br>
                            <strong>Status:</strong> ‚úì Correct
                        </div>
                    </div>
                </div>
            </div>
            
            <h3 style="margin-top: 30px; color: #333;">Path 2: Quick Workout</h3>
            <div class="flow-diagram">
                <div class="flow-row">
                    <div class="flow-box create">
                        <div class="flow-title">üü¢ User Action</div>
                        <div class="flow-details">
                            Create quick workout via "Quick Workout" button
                        </div>
                    </div>
                    <div class="arrow">‚Üí</div>
                    <div class="flow-box create">
                        <div class="flow-title">üìù QuickWorkoutBuilderDialog</div>
                        <div class="flow-details">
                            <span class="code">createTestEvent()</span><br>
                            Creates workout in Firebase
                        </div>
                    </div>
                    <div class="arrow">‚Üí</div>
                    <div class="flow-box store" style="border-color: #ffa726;">
                        <div class="flow-title">‚ö†Ô∏è Firebase calendarEvents</div>
                        <div class="flow-details">
                            Event stored in Firebase only<br>
                            <strong>Status:</strong> ‚ùå Missing Google Calendar sync
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="warning">
                <div class="warning-title">‚ö†Ô∏è ISSUE: Quick Workouts Not in Google Calendar</div>
                <div>Quick workouts create events in Firebase but NOT in Google Calendar. This means:
                <ul>
                    <li>They show up in the app (if Firebase fallback works)</li>
                    <li>But they DON'T show up in the user's actual Google Calendar</li>
                    <li>And if Google Calendar API is the only source, quick workouts won't show at all</li>
                </ul>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">üîó Data Relationships</div>
            <table>
                <thead>
                    <tr>
                        <th>Entity</th>
                        <th>Stored In</th>
                        <th>Links To</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Period Assignment Event</strong></td>
                        <td>Google Calendar API</td>
                        <td>
                            <ul>
                                <li>extendedProperties.pcaClientId ‚Üí client</li>
                                <li>extendedProperties.pcaCategory ‚Üí category</li>
                                <li>extendedProperties.pcaWorkoutId ‚Üí clientWorkouts (sometimes)</li>
                            </ul>
                        </td>
                        <td><span class="status-badge status-works">‚úì Correct</span></td>
                    </tr>
                    <tr>
                        <td><strong>Quick Workout Event</strong></td>
                        <td>Firebase calendarEvents</td>
                        <td>
                            <ul>
                                <li>preConfiguredClient ‚Üí client</li>
                                <li>linkedWorkoutId ‚Üí clientWorkouts</li>
                                <li>description metadata ‚Üí periodId, workoutId</li>
                            </ul>
                        </td>
                        <td><span class="status-badge status-broken">‚ùå Wrong Location</span></td>
                    </tr>
                    <tr>
                        <td><strong>Workout Details</strong></td>
                        <td>Firebase clientWorkouts</td>
                        <td>
                            <ul>
                                <li>clientId ‚Üí clients</li>
                                <li>periodId ‚Üí client-programs.periods</li>
                                <li>linked via event.linkedWorkoutId</li>
                            </ul>
                        </td>
                        <td><span class="status-badge status-works">‚úì Correct</span></td>
                    </tr>
                    <tr>
                        <td><strong>Client Programs</strong></td>
                        <td>Firebase client-programs</td>
                        <td>
                            <ul>
                                <li>clientId ‚Üí clients</li>
                                <li>periods contain workout schedules</li>
                            </ul>
                        </td>
                        <td><span class="status-badge status-works">‚úì Correct</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="section">
            <div class="section-title">üí° Recommended Architecture</div>
            
            <div class="info">
                <div class="info-title">‚úÖ Google Calendar as Single Source of Truth</div>
                <div>
                    <strong>Calendar Events:</strong>
                    <ul>
                        <li><strong>ALL</strong> calendar events should be in Google Calendar API (period assignments AND quick workouts)</li>
                        <li>Remove Firebase calendarEvents collection OR use it only as a temporary cache</li>
                        <li>Reading should ONLY query Google Calendar API (no Firebase fallback for events)</li>
                    </ul>
                    
                    <strong>Firebase Collections (Keep these):</strong>
                    <ul>
                        <li>‚úì <span class="code">clientWorkouts</span> - Workout exercise details</li>
                        <li>‚úì <span class="code">client-programs</span> - Client training programs</li>
                        <li>‚úì <span class="code">clients</span> - Client information</li>
                        <li>‚úì <span class="code">scheduled-workouts</span> - Workout scheduling metadata</li>
                        <li>‚úì All configuration collections (periods, workoutTypes, etc.)</li>
                    </ul>
                    
                    <strong>Changes Needed:</strong>
                    <ul>
                        <li>1. Update <span class="code">createTestEvent</span> to also create in Google Calendar</li>
                        <li>2. Remove Firebase fallback from <span class="code">getCalendarEventsByDateRange</span></li>
                        <li>3. Only read from Google Calendar API (if not connected, show error/message)</li>
                        <li>4. Consider removing Firebase calendarEvents collection entirely</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">üî® ALL Creation Paths - Wireframe Flows</div>
            
            <h3 style="margin-top: 20px; color: #333; font-size: 1.4em;">Path 1: Click Empty Schedule Timeslot</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <strong>User clicks empty timeslot</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Schedule grid ‚Üí Dialog opens</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>CreateScheduleEventDialog</strong><br>
                        <span style="color: #666; font-size: 0.9em;">User fills: Client, Category, Title, Time</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>createTestEvent()</strong><br>
                        <span style="color: #dc3545;">‚ùå Creates in Firebase calendarEvents ONLY</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px; background: #fff3cd; padding: 10px; border-radius: 4px;">
                        <strong>üî• Firebase calendarEvents</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Event stored</span><br>
                        <span style="color: #666; font-size: 0.9em;">Auto-creates workout in Firebase</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #fff; border-left: 3px solid #dc3545; border-radius: 4px;">
                    <strong>‚ö†Ô∏è Issue:</strong> Event not in Google Calendar, so it won't show up in your actual calendar
                </div>
            </div>
            
            <h3 style="margin-top: 40px; color: #333; font-size: 1.4em;">Path 2: Period Assignment (Recurring Events)</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <strong>User assigns period</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Assign Period button ‚Üí Dialog</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>handleAssignPeriod()</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Creates period in Firebase</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>createRecurringCalendarEvent()</strong><br>
                        <span style="color: #28a745;">‚úÖ Creates in Google Calendar API</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px; background: #e3f2fd; padding: 10px; border-radius: 4px;">
                        <strong>üìÖ Google Calendar API</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Recurring event (RRULE)</span><br>
                        <span style="color: #666; font-size: 0.9em;">Metadata: clientId, periodId</span>
                    </div>
                </div>
                <div style="margin-top: 15px; display: flex; align-items: center; gap: 15px;">
                    <div style="flex: 0 0 50px;"></div>
                    <div style="font-size: 1.5em;">‚Üì</div>
                    <div style="flex: 1; background: #fff3e0; padding: 10px; border-radius: 4px;">
                        <strong>üí™ Firebase clientWorkouts</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Individual workouts for each day</span><br>
                        <span style="color: #666; font-size: 0.9em;">Linked via periodId</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #d1ecf1; border-left: 3px solid #0dcaf0; border-radius: 4px;">
                    <strong>‚úÖ This works correctly!</strong> Creates schedule (Google Calendar) AND workouts (Firebase) separately but connected
                </div>
            </div>
            
            <h3 style="margin-top: 40px; color: #333; font-size: 1.4em;">Path 3: Quick Workout Builder</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <strong>User clicks "Quick Workout"</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Button ‚Üí Dialog opens</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>QuickWorkoutBuilderDialog</strong><br>
                        <span style="color: #666; font-size: 0.9em;">User creates: Workout details (exercises, sets, reps)</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>createClientWorkout()</strong><br>
                        <span style="color: #28a745;">‚úÖ Creates WORKOUT in Firebase</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px; background: #fff3e0; padding: 10px; border-radius: 4px;">
                        <strong>üí™ Firebase clientWorkouts</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Workout stored (exercises, sets, reps)</span><br>
                        <span style="color: #28a745;">‚úÖ Correct - workouts belong here</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #fff; border-left: 3px solid #ff9800; border-radius: 4px;">
                    <strong>If time provided:</strong>
                </div>
                <div style="margin-top: 10px; display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 0 0 50px;"></div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>createTestEvent()</strong><br>
                        <span style="color: #dc3545;">‚ùå Creates SCHEDULE in Firebase calendarEvents ONLY</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px; background: #fff3cd; padding: 10px; border-radius: 4px;">
                        <strong>üìÖ Firebase calendarEvents</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Schedule event stored</span><br>
                        <span style="color: #666; font-size: 0.9em;">linkedWorkoutId ‚Üí workout</span><br>
                        <span style="color: #dc3545;">‚ùå Not in Google Calendar</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #fff; border-left: 3px solid #dc3545; border-radius: 4px;">
                    <strong>‚ö†Ô∏è Issue:</strong> Workout (Firebase) is correct, but Schedule (event) should also be in Google Calendar
                </div>
            </div>
            
            <h3 style="margin-top: 40px; color: #333; font-size: 1.4em;">Path 4: Drag/Drop Category (Move Workout)</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <strong>User drags category</strong><br>
                        <span style="color: #666; font-size: 0.9em;">From one date to another</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>handleMoveWorkoutCategory()</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Updates period.days array</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px; background: #fff3e0; padding: 10px; border-radius: 4px;">
                        <strong>üî• Firebase client-programs</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Internal scheduling only</span><br>
                        <span style="color: #666; font-size: 0.9em;">No calendar event created</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #fff; border-left: 3px solid #6c757d; border-radius: 4px;">
                    <strong>‚ÑπÔ∏è Note:</strong> This is internal workout scheduling only. No schedule/calendar event needed.
                </div>
            </div>
            
            <h3 style="margin-top: 40px; color: #333; font-size: 1.4em;">Path 5: From Workout Builder Page</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <strong>User creates workout</strong><br>
                        <span style="color: #666; font-size: 0.9em;">On Builder page (exercises, sets, reps)</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>Workout Builder</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Creates workout in Firebase</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px; background: #fff3e0; padding: 10px; border-radius: 4px;">
                        <strong>üí™ Firebase clientWorkouts</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Workout stored</span><br>
                        <span style="color: #28a745;">‚úÖ Correct - workouts belong here</span><br>
                        <span style="color: #666; font-size: 0.9em;">May link to existing calendar event if one exists</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #fff; border-left: 3px solid #6c757d; border-radius: 4px;">
                    <strong>‚ÑπÔ∏è Note:</strong> Creates workout only. No schedule/calendar event created. (This is correct - workouts and schedules are separate)
                </div>
            </div>
            
            <h3 style="margin-top: 40px; color: #333; font-size: 1.4em;">Path 6: Period Assignment Fallback</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #667eea;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 200px;">
                        <strong>Recurring event fails</strong><br>
                        <span style="color: #666; font-size: 0.9em;">OR no week template ‚Üí Fallback</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>Creates individual workouts</strong><br>
                        <span style="color: #666; font-size: 0.9em;">For each day</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px; background: #fff3e0; padding: 10px; border-radius: 4px;">
                        <strong>üí™ Firebase clientWorkouts</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Workouts stored</span><br>
                        <span style="color: #28a745;">‚úÖ Correct</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px;">
                        <strong>createTestEvent()</strong><br>
                        <span style="color: #dc3545;">‚ùå Creates SCHEDULE in Firebase ONLY</span>
                    </div>
                    <div style="font-size: 1.5em;">‚Üí</div>
                    <div style="flex: 1; min-width: 200px; background: #fff3cd; padding: 10px; border-radius: 4px;">
                        <strong>üìÖ Firebase calendarEvents</strong><br>
                        <span style="color: #666; font-size: 0.9em;">Schedule event stored</span><br>
                        <span style="color: #dc3545;">‚ùå Not in Google Calendar</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #fff; border-left: 3px solid #dc3545; border-radius: 4px;">
                    <strong>‚ö†Ô∏è Issue:</strong> Schedule should be in Google Calendar, not Firebase
                </div>
            </div>
            
            <div class="section" style="margin-top: 50px;">
                <div class="section-title">üéØ Summary of All Creation Paths</div>
                <table>
                    <thead>
                        <tr>
                            <th>Path</th>
                            <th>User Action</th>
                            <th>Creates in Google Calendar?</th>
                            <th>Creates in Firebase?</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>1. Click Schedule Timeslot</strong></td>
                            <td>Click empty timeslot</td>
                            <td>‚ùå No</td>
                            <td>‚úÖ calendarEvents + clientWorkouts</td>
                            <td><span class="status-badge status-broken">Needs Fix</span></td>
                        </tr>
                        <tr>
                            <td><strong>2. Period Assignment</strong></td>
                            <td>Assign period to client</td>
                            <td>‚úÖ Yes (recurring)</td>
                            <td>‚úÖ client-programs + clientWorkouts</td>
                            <td><span class="status-badge status-works">‚úì Correct</span></td>
                        </tr>
                        <tr>
                            <td><strong>3. Quick Workout</strong></td>
                            <td>Create quick workout</td>
                            <td>‚ùå No (if time provided)</td>
                            <td>‚úÖ clientWorkouts + calendarEvents (if time)</td>
                            <td><span class="status-badge status-broken">Needs Fix</span></td>
                        </tr>
                        <tr>
                            <td><strong>4. Drag/Drop Category</strong></td>
                            <td>Move workout to new date</td>
                            <td>‚ùå No</td>
                            <td>‚úÖ client-programs (period.days)</td>
                            <td><span class="status-badge status-partial">Internal Only</span></td>
                        </tr>
                        <tr>
                            <td><strong>5. Builder Page</strong></td>
                            <td>Create workout in builder</td>
                            <td>‚ùå No</td>
                            <td>‚úÖ clientWorkouts</td>
                            <td><span class="status-badge status-partial">Workout Only</span></td>
                        </tr>
                        <tr>
                            <td><strong>6. Period Fallback</strong></td>
                            <td>Period assignment fallback</td>
                            <td>‚ùå No</td>
                            <td>‚úÖ calendarEvents + clientWorkouts</td>
                            <td><span class="status-badge status-broken">Needs Fix</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="current-issue" style="margin-top: 40px;">
                <div class="current-issue-title">üéØ KEY INSIGHT: When Should Calendar Events Be Created?</div>
                <div>
                    <strong>Calendar events (Google Calendar API) should be created when:</strong>
                    <ul>
                        <li>‚úÖ User explicitly schedules an event with a time (Path 1, 3)</li>
                        <li>‚úÖ Period assignments create recurring events (Path 2)</li>
                        <li>‚ùå NOT when just creating a workout without scheduling (Path 5)</li>
                        <li>‚ùå NOT when just moving categories internally (Path 4)</li>
                    </ul>
                    
                    <strong>Current Problem:</strong>
                    <ul>
                        <li>Paths 1, 3, and 6 create events in Firebase only</li>
                        <li>These events don't show up in Google Calendar</li>
                        <li>If we read only from Google Calendar, these events disappear</li>
                    </ul>
                    
                    <strong>Solution Options:</strong>
                    <ul>
                        <li><strong>Option A:</strong> Make Paths 1, 3, 6 ALSO create in Google Calendar (recommended)</li>
                        <li><strong>Option B:</strong> Add prompt: "Create calendar event for this workout?" when creating workout</li>
                        <li><strong>Option C:</strong> Only create calendar events for period assignments (current state, but loses quick workout scheduling)</li>
                    </ul>
                </div>
            </div>
            
        <div class="section">
            <div class="section-title">üìã Summary</div>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Current State</th>
                        <th>Issue</th>
                        <th>Fix Needed</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Period Assignments</strong></td>
                        <td>Creates in Google Calendar ‚úì</td>
                        <td>None</td>
                        <td>Keep as-is</td>
                    </tr>
                    <tr>
                        <td><strong>Quick Workouts</strong></td>
                        <td>Creates in Firebase only ‚ùå</td>
                        <td>Not in Google Calendar</td>
                        <td>Also create in Google Calendar</td>
                    </tr>
                    <tr>
                        <td><strong>Reading Events</strong></td>
                        <td>Tries Google Calendar, falls back to Firebase ‚ö†Ô∏è</td>
                        <td>Firebase fallback hides missing Google Calendar events</td>
                        <td>Remove Firebase fallback, only read from Google Calendar</td>
                    </tr>
                    <tr>
                        <td><strong>Workouts</strong></td>
                        <td>Stored in Firebase ‚úì</td>
                        <td>None</td>
                        <td>Keep as-is</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
